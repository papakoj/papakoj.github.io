<h3 style="margin-top:3%">Leave a comment</h3>
<p id="requiredinfo"> Your email will not be displayed. <em>*</em> denotes a required field. </p>
<form action="/fake" method="post" id="commentform" class="form-horizontal">
  <fieldset id="commentfields">
    <textarea class="maincommenttext" name="message" id="message" rows="6"></textarea>
    <input style="display:block" name="redirect" type="hidden" value="{{ site.url }}">
    <input name="post_id" type="hidden" value="{{ slug }}">
    <input style="display:block" name="comment-site" type="hidden" value="{{ site.url }}">
    <label class="commentformlabel" for="name">Name <span> *</span></label>
    <input class="commentforminput" type="text" name="name" id="name" maxlength="100"/>
    <label class="commentformlabel" for="email">Email <span> *</span></label>
    <input class="commentforminput" type="text" name="email" id="email" maxlength="100"/>

    <label class="commentformlabel" for="url">Website</label>
    <input class="commentforminput" type="text" name="url" id="url" maxlength="100"/>

    <button onclick="setupForm()" type="button" class="btn btn-active" id="commentbutton">Leave response</button>
  </fieldset>
</form>

<!-- <form action="/fake" data-action="{{ site.comments.receiver }}" method="post" id="commentform">
  <input name="redirect" type="hidden" value="{{site.url}}/thanks">
  <input name="post_id" type="hidden" value="{{ slug }}">
  <input name="comment-site" type="hidden" value="{{ site.url }}">
  <div id="comment-box">
    <img src="/images/comments/unknown-avatar.png" data-fallbacksrc="/images/comments/unknown-avatar.png" data-role="user-avatar" alt="avatar" class="avatar" id="avatarPreview" />
    <div id="commenttext">
      <div id="commentstatus" class="status"></div>
      <div contenteditable="PLAINTEXT-ONLY" tabindex="0" role="textbox" aria-multiline="true" data-role="editable" class="textarea" aria-label="Join the discussion..." id="comment-div"></div>
      <input type="hidden" name="message" id="message" data-required="true" value="" />
    </div>
  </div>
  <div id="comment-author">
    <div class="control-group">
      <input type="hidden" name="avatar" id="avatarInput" />
      <input type="text" name="name" id="name" placeholder="Display Name" title="Name displayed with your comment" data-required="true" />
      <input type="text" name="identity" id="identity" placeholder="email/@twitter/github" data-required="true" value="" />
      <span class="info-circle" title="Identity is used to generate an avatar image only. It is not submitted with the form."></span>
      <button type="button" id="commentbutton">Leave response</button>
      <div id="remember-me">
        <input type="checkbox" name="remember" id="remember"><label for="remember">Remember me</label>
        <span class="info-circle" title="Stores your name and email in the browser so you don't have to fill out the form again. This does not set a cookie."></span>
      </div>
    </div>
  </div>
</form> -->
<script>
    function setupForm() {
      var status = document.getElementById('commentstatus')
      status.innerText = ''

      var requiredIds = [ 'message', 'email', 'name']
      var missing = requiredIds.filter(id => document.getElementById(id).value.length < 3)
      if (missing.length > 0) {
        for (var i = 0; i < missing.length; i++) {
          document.getElementById(missing[i]).style.borderColor = "red";
        }
        status.innerText = 'Some required fields are missing - (' + missing.join(', ') + ')'
        return
      }

      var button = document.getElementById('commentbutton')
      if (button.innerText != 'Confirm comment') {
        button.innerText = 'Confirm comment'
        return
      }

      var form = document.getElementById('commentform')
      form.action = '{{ site.comments.receiver }}'
      button.innerText = 'Posting...'
      button.disabled = true
      form.submit()
      var fields = document.getElementById('commentfields')
      fields.disabled = true
    }
  </script>
<div id="commentstatus" style="clear:both" class="status"></div>
